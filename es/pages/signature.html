<!doctype html>
<html>
<head>
	<link href='https://fonts.googleapis.com/css?family=DM Sans' rel='stylesheet'>
	<meta charset="utf-8">
	<title>Firma de entrada</title>
	<link href="./css/style.css" rel="stylesheet" type="text/css">
	<script src="js/api_request.js"></script>
</head>

<style>
		p{
			font-size: 13px;
		}

		#makepdf {
			box-sizing: content-box;
			width: 810px;
			height: 645px;
			padding: 30px;
			border: 1px solid black;
			font-style: sans-serif;
			background-color: white;  /* #f0f0f0*/
			position: absolute;
			top: 4%;
			left: 2%;
			border-radius: 7px;
		}

		#button {
			background-color: #4caf50;
			border-radius: 5px;
			color: white;
			top: 0%;
			left: 2%;
			position:absolute;
		}

		h2 {
			text-align: center;
		}
</style>
	
<body>
	<div id="uploadLogo" style="position: absolute; top:10%; left:42.5%; z-index: 10; opacity: 0;"> 
			<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
		<lottie-player src="https://assets8.lottiefiles.com/temp/lf20_edwUDF.json"  background="transparent"  speed="1"  style="width: 400px; height: 400px;"  loop  autoplay></lottie-player>
	</div>
	
	<span style="position: absolute; top:10%; left:-20%;" class="dot"></span>
	
	<div id="signature_page"> 
		
		<div id="makepdf" style="position: absolute; width: 45%; height: 75%; left: 3%; top:10%;">	
			
			<h2 style="color:#9642E0; text-align:left; font-size: 35px;"> Parte de viajeros / Hoja de bienvenida</h2>
			<br><!---->
			
			<p style="font-size: 30px; color: #DE45C4;">  <strong>Datos del establecimiento </strong></p>
			<hr>
			<p style="font-size: 25px;">
			<strong>CIF:<strong>B95933255 </p> 
			<hr>
			<p style="font-size: 25px;">
			<strong>Número de parte:<strong>xxxxx</p> 
			<hr>
			<p style="font-size: 25px;">
			<strong>Nombre del establecimiento:<strong> Hotel Artxanda </p>
			<hr>
			<p style="font-size: 25px;">
			<strong>Municipio:<strong> Artxanda</p> 
			<hr>
			<p style="font-size: 25px;">
			<strong>Provincia:<strong> Bilbao</p> 
			<br><br><br><!-- -->
			
			<p style="font-size: 30px; color: #DE45C4;"> <strong>Datos del viajero:</strong> </p>
			<hr>
			<p>
			<p style="font-size: 20px;" id="guestDocumentNumber"><strong>Número de documento de identidad:<strong> </p> 
			<hr>
			<p style="font-size: 20px;" id="guestDocumentType"><strong>Tipo de documento:<strong> </p>
			<hr>
			<p style="font-size: 20px;" id="guestDocumentExpirationDate"><strong>Fecha de vencimiento del documento:<strong> </p>
			<hr>
			<p style="font-size: 20px;" id="guestFirstName"><strong>Nombre:<strong> </p> 
			<hr>
			<p style="font-size: 20px;" id="guestLastName"><strong>Apellido:<strong> </p> 
			<hr>
			<p style="font-size: 20px;" id="guestBirthDate"><strong>Fecha de nacimiento:<strong> </p>
			<hr>
			<p style="font-size: 20px;" id="guestCountry"><strong>País de nacionalidad:<strong> </p>
			<hr>
			<p style="font-size: 20px;" id="startDate"><strong>Fecha de entrada:<strong> </p>
			</p>
			<hr>
			<p style="font-size: 20px;">
					La recogida y tratamiento de estos datos se hará de acuerdo con la Ley Orgánica 3/2018, de 5 de
					diciembre, de Protección de Datos Personales y garantía de los derechos digitales, y en lo que resulte
					de aplicación, la relativa a la protección de las personas físicas en lo que respecta al tratamiento de
					datos personales por parte de autoridades competentes para fines de prevención, investigación,
					detección o enjuiciamiento de infracciones penales, y al amparo Ley Orgánica 4/2015, de 30 de
					marzo, de Protección de la Seguridad Ciudadana, artículo 25.1.
			</p>
			
				
		</div>

		<div  style="position: absolute; top:15%; left: 60%;">
				
		 		<canvas id="sig-canvas" width="360px" height="360px" style="border:1px solid #222222; background-color: white;  color: white;">
		 			
		 		</canvas>
		
		 		<canvas hidden id="empty-canvas" width="360px" height="360px" style="border:1px solid #222222; background-color: white;  color: white;">
		 			
		 		</canvas>

		</div>

		<p style="position: absolute; top:4%; right: 15%; font-family: 'DM Sans'; color: #6B43F1; font-size: 60px; z-index: 3;"><strong>Firme aquí</strong></p>		
		<button class="btn-5" id="sig-submitBtn"   style="width: 200px; height: 100px; position: absolute; right:23%; bottom:45.5%; color: #fff; background: #6263D5; border-width: inherit; border-radius: 10px; font-size: 35px;">Aceptar</button>

	    <div style="position: absolute; left: 60%; bottom:60%; color:black; font-size: 30px;">
      		<input style="color: #6B43F1; width: 30px; height: 30px;" type="checkbox" id="acepta" name="acepta">
      		<label style="position: relative; top:-5px; font-size: 25px;" for="scales">He leído y  acepto los términos de uso y política de seguridad.</label>
   		</div>
	
		<div id="atras" style="position:absolute; left:82%; bottom:46.3%" onclick="location.href='documento_id.html';"> 
					<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
					<lottie-player src="https://assets7.lottiefiles.com/private_files/lf30_bxgjo2wa.json"  background="transparent"  speed="1"  style="width: 100px; height: 100px;"  loop autoplay></lottie-player>
		</div>
		
		<script src="js/signature.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	
		<script>
			
		console.log("localStorage Sig",localStorage.getItem("postGuest") );
		console.log("guest_aditional", localStorage.getItem("guest_aditional"));

		var postGuest_json2 = JSON.parse(localStorage.postGuest);
		console.log("default data",postGuest_json2);
		
		var guest_aditional_json = JSON.parse( localStorage.guest_aditional);
		
		var guest2process_data = JSON.parse(localStorage.guest2process_data);				
		
		if (guest2process_data.i == 1){
				console.log("in window");
			set_form_info_in_window(postGuest_json2, postGuest_json2.startDate);}
			
		else{
			set_form_info_in_window(guest_aditional_json, postGuest_json2.startDate);
		};

		
		var guestInfo = '{"startDate": "","endDate":"",	"guestFirstName": "","guestLastName":"","guestCountry": "",	"guestZip": "","guestEmail": "",	"guestPhone":"","rooms": "","adults":"","children": "", "roomPicked":""}';
		
		var guestInfo_json = JSON.parse(guestInfo);
		guestInfo_json.startDate = postGuest_json2.startDate;
		guestInfo_json.endDate = postGuest_json2.endDate;
		guestInfo_json.guestFirstName = postGuest_json2.guestFirstName;
		guestInfo_json.guestLastName = postGuest_json2.guestLastName;
		guestInfo_json.guestCountry = postGuest_json2.guestCountry;
		guestInfo_json.guestZip = postGuest_json2.guestZip;
		guestInfo_json.guestEmail = postGuest_json2.guestEmail;
		guestInfo_json.guestCellPhone = postGuest_json2.guestCellPhone;
		guestInfo_json.adults = postGuest_json2.adults;
		guestInfo_json.children = postGuest_json2.children;
		guestInfo_json.roomPicked = postGuest_json2.roomPicked;
				
			
		//guestInfo = JSON.stringify(guestInfo_json);
		var tmp_rooms = postGuest_json2.rooms;
		console.log("Room picked info", guestInfo_json.roomPicked);
		console.log("Rooms info", postGuest_json2.rooms);
		console.log("postGuest_json2 with all rooms and their info", postGuest_json2);
			
		for(const i in tmp_rooms){
				//console.log("index",i);
				//var name = tmp_rooms[i].roomTypeName;
				if(guestInfo_json.roomPicked === tmp_rooms[i].roomTypeName){
					postGuest_json2.rooms =  [tmp_rooms[i]];  //tmp_rooms[i][0];
					console.log("Comparison ",i, "room type", tmp_rooms[i].roomTypeName);
					//break;
				}
			};	
		console.log("postGuest_json2 just with picked rooms info", postGuest_json2);

		var post_info = '{"rooms":"","guestInfo":""}';
		var post_info_json = JSON.parse(post_info);
		post_info_json.rooms = postGuest_json2.rooms;
		post_info_json.guestInfo = guestInfo_json;
		post_info = JSON.stringify(post_info_json);
		
		console.log("Post input info", post_info);
		console.log("With reservation flag ", localStorage.with_reservation_flag);
		console.log("guest2process_data.i ", guest2process_data.i);
			
		if (localStorage.with_reservation_flag == "false" && guest2process_data.i == 1){
			console.log("Creando reserva");
			//console.log("Body de postReservation", post_info);	
			let reservationID = fetchAsync_postReservation("http://127.0.0.1:5000/postReservation", post_info);
			console.log("post response: reservationID",reservationID);
		
		}

	
			
			
function set_form_info_in_window(postGuest_json2, startDate_in){
		
	console.log("Set client infor in window");
		var guestDocumentNumber = document.getElementById("guestDocumentNumber");
		var guestDocumentType = document.getElementById("guestDocumentType");
		var guestDocumentExpirationDate = document.getElementById("guestDocumentExpirationDate");
		var guestFirstName = document.getElementById("guestFirstName");
		var guestLastName = document.getElementById("guestLastName");
		var guestBirthDate = document.getElementById("guestBirthDate");
		var guestCountry = document.getElementById("guestCountry");
		var startDate = document.getElementById("startDate");
		
		guestDocumentNumber.textContent += postGuest_json2.guestDocumentNumber;		
		guestDocumentType.textContent += postGuest_json2.guestDocumentType;		
		guestDocumentExpirationDate.textContent += postGuest_json2.guestDocumentExpirationDate;		
		guestFirstName.textContent += postGuest_json2.guestFirstName;		
		guestLastName.textContent += postGuest_json2.guestLastName;		
		guestBirthDate.textContent += postGuest_json2.guestBirthDate;		
		guestCountry.textContent += postGuest_json2.guestCountry;		
		startDate.textContent += startDate_in;		
		
	
}	
			
function save_signature(){

	let response = fetchAsync_take_send_picture("http://localhost:7000/postGuestDocument?guestID="+guestID+"&pathDocument=");
	console.log("Signature function");
	var canvas = document.getElementById("sig-canvas"),
    ctx = canvas.getContext("2d"),
    savedData = new Image();
    savedData.src = canvas.toDataURL("signatures/sig.png");
	
	
}
		</script>
				
</div>
				
</body>
</html>
