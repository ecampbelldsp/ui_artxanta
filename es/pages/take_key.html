<!DOCTYPE html>
<html>
<head>
	<link href='https://fonts.googleapis.com/css?family=DM Sans' rel='stylesheet'>
<meta charset="utf-8">
<title>Llave de habitación</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="./css/style.css" rel="stylesheet" type="text/css">
<script src="js/api_request.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js" integrity="sha512-1/RvZTcCDEUjY/CypiMz+iqqtaoQfAITmNSJY17Myp4Ms5mdxPS5UV7iOfdZoxcGhzFbOm6sntTKJppjvuhg4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.12/sweetalert2.all.js" integrity="sha512-7TfWz/1TEVLE2pG8KLC/suq4qgXocI+/sNKfX0yifGXBbSKPoA9wcQ2GDublV7SSCu90vnW1q7+TUXOYaCIshA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

      <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel = "stylesheet">
      <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
      <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
      
     
	
	<script type="text/javascript">
		
	$(window).load(function(){
		$(".fundir").animate({opacity:"1"});
	})
	
	</script>
</head>
<body style="background: #EBEBEB;justify-content:center;display:flex;margin:0px; font-family: 'DM Sans';zoom:150%;">
    <div style="width:70%;position:absolute;text-align:center;margin-top:20px;user-select:none;font-size:14px">
      <h3 style="display:inline-block;font-size:18px; margin-right:50px">Pasos <br>Check-In:</h3>
      <div style="display:inline-block; color:#cb30ad;">1<br>Reserva</div>
      <div style="width:5%;display:inline-block;border-bottom:1px dotted #cb30ad;vertical-align:super;"></div>
      <div style="display:inline-block; color:#cb30ad;">2<br>Identificación</div>
      <div style="width:5%;display:inline-block;border-bottom:1px dotted #cb30ad;vertical-align:super;"></div>
      <div style="display:inline-block; color:#cb30ad;">3<br>Pago</div>
      <div style="width:5%;display:inline-block;border-bottom:1px dotted #cb30ad;vertical-align:super;"></div>
      <div style="display:inline-block;color:#cb30ad;">4<br>Factura</div>
      <div style="width:5%;display:inline-block;border-bottom:1px dotted #cb30ad;vertical-align:super;"></div>
      <div style="display:inline-block;font-size:18px;font-weight:800; color:#cb30ad;">5<br>Llave</div>
    </div>
	<audio  id="audio" autoplay src="Audios/10.-.mp3"  type="audio/mpeg"> </audio>

	
	
	<span style="position: absolute;margin-top: 25vh;margin-left: -100%;z-index:-1" class="dot"></span>

	<div class="fundir" style=" border-radius: 25px;background-color:white;height:800px; width: 500px;margin-top: 18vh;opacity:0;display:block;text-align:center">
		<div style="max-height:70%;overflow:hidden;border-radius: 25px;">
			<img src="image/bienvenida.jpg" style=" border-radius: 25px; z-index: 0;width:100%;height:auto" alt="Hall" width="400" height="450">
		</div>
		<p id="roomID" style="font-family: DM Sans; font-size: 50px; font-weight: bold; color: #6B43F1; margin-top: 10px;padding:30px; opacity: 0;">  Recoja su llave. <strong>Habitación</strong> <br></p>

		<p id="cartel_reserva_creada" style="font-family: DM Sans; font-size: 37px; font-weight: bold; color: #6B43F1; margin-top: 10px;padding:30px; position: relative; bottom:200px; opacity: 0;">  <strong>Reserva creada con éxito</strong> <br> </p>
		<p id="localizador" style="font-family: DM Sans; font-size: 45px; font-weight: bold; color: #6B43F1; margin-top: 10px;padding:30px; position: relative; bottom:250px; opacity: 0;">  <strong>Localizador:</strong> <br> </p>

</body> 
	
	<script>
		
	//Printing ticket

		var postGuest_jsonPago = JSON.parse(localStorage.postGuest);
		    console.log("Guest info", postGuest_jsonPago)
		    
			
			/*var invoice = '{"hotelName": "Hotel Artxanda Bilbao","hotelPhone": "+34 628234078","hotelAddress": "Carretera Santo Domingo a, Enekuri Artxanda Errepidea, 3, 48015 Bilbo, Bizkaia","checkIn":"","checkOut": "","roomType": "","reservationID": "","taxRate": "21","roomPrice": "","items": ""}'

			var invoice_json = JSON.parse(invoice)
			invoice_json.checkIn = postGuest_jsonPago.startDate
			invoice_json.checkOut = postGuest_jsonPago.endDate
			invoice_json.roomType = postGuest_jsonPago.roomPicked
			invoice_json.reservationID = postGuest_jsonPago.reservationID
			invoice_json.roomPrice = postGuest_jsonPago.balance
			invoice_json.items ={}

			var invoice_String = JSON.stringify(invoice_json)*/


			//var tmp = '{"hotelName": "NH Vigo","hotelPhone": "+34 696548985","hotelAddress": "Rúa Sol 30","checkIn": "2023-05-16","checkOut": "2023-05-18","roomType": "Kings Room","reservationID": "444599862","taxRate": "21","roomPrice": "150","items": {"Late Check-Out": "15","Extra clean": "50"}}'
			


    const invoice = {"hotelName": "Hotel Artxanda Bilbao",
  "hotelPhone": "+34 628234078",
  "hotelAddress": "Carretera Santo Domingo a, Enekuri Artxanda Errepidea, 3, 48015 Bilbo, Bizkaia",
  "checkIn":postGuest_jsonPago.startDate,
  "checkOut": postGuest_jsonPago.endDate,
  "roomType": postGuest_jsonPago.roomPicked,
  "reservationID": postGuest_jsonPago.reservationID,
  "taxRate": "21",
  "roomPrice": postGuest_jsonPago.balance,
  "items": {}};

 invoice_String = JSON.stringify(invoice)
  console.log("Invoice string", invoice_String)

  let response_printer =  fetchAsync_print_ticket("http://localhost:6400/api-hardware/v1/printer/msh245/printTicket", invoice_String);
  console.log("Response printer", response_printer);

//		Post reservation
	/*	console.log("localStorage Sig",localStorage.getItem("postGuest") );
		console.log("guest_aditional", localStorage.getItem("guest_aditional"));

		var postGuest_json2 = JSON.parse(localStorage.postGuest);
		console.log("default data",postGuest_json2);
		
				

		var guest2process_data = JSON.parse(localStorage.guest2process_data);
		var guestInfo = '{"startDate": "","endDate":"",	"guestFirstName": "","guestLastName":"","guestCountry": "",	"guestZip": "","guestEmail": "",	"guestPhone":"","rooms": "","adults":"","children": "", "roomPicked":""}';
		
		var guestInfo_json = JSON.parse(guestInfo);
		guestInfo_json.startDate = postGuest_json2.startDate;
		guestInfo_json.endDate = postGuest_json2.endDate;
		guestInfo_json.guestFirstName = postGuest_json2.guestFirstName;
		guestInfo_json.guestLastName = postGuest_json2.guestLastName;
		guestInfo_json.guestCountry = postGuest_json2.guestCountry;
		guestInfo_json.guestZip = postGuest_json2.guestZip;
		guestInfo_json.guestEmail = postGuest_json2.guestEmail;
		guestInfo_json.guestCellPhone = postGuest_json2.guestCellPhone;
		guestInfo_json.adults = postGuest_json2.adults;
		guestInfo_json.children = postGuest_json2.children;
		guestInfo_json.roomPicked = postGuest_json2.roomPicked;
				
			
		//guestInfo = JSON.stringify(guestInfo_json);
		var tmp_rooms = postGuest_json2.rooms;
		console.log("Room picked info", guestInfo_json.roomPicked);
		console.log("Rooms info", postGuest_json2.rooms);
		console.log("postGuest_json2 with all rooms and their info", postGuest_json2);
			
		for(const i in tmp_rooms){
				//console.log("index",i);
				//var name = tmp_rooms[i].roomTypeName;
				if(guestInfo_json.roomPicked === tmp_rooms[i].roomTypeName){
					postGuest_json2.rooms =  [tmp_rooms[i]];  //tmp_rooms[i][0];
					console.log("Comparison ",i, "room type", tmp_rooms[i].roomTypeName);
					//break;
				}
			};	
		console.log("postGuest_json2 just with picked rooms info", postGuest_json2);

		var post_info = '{"rooms":"","guestInfo":""}';
		var post_info_json = JSON.parse(post_info);
		post_info_json.rooms = postGuest_json2.rooms;
		post_info_json.guestInfo = guestInfo_json;
		post_info = JSON.stringify(post_info_json);
		
		console.log("Post input info", post_info);
		console.log("With reservation flag ", localStorage.with_reservation_flag);
		console.log("guest2process_data.i ", guest2process_data.i);
			
		if (localStorage.with_reservation_flag == "false"){
			console.log("Creando reserva");
			//console.log("Body de postReservation", post_info);	
			let reservationID = fetchAsync_postReservation("http://127.0.0.1:5000/postReservation", post_info);
			console.log("post response: reservationID",reservationID);
		
		}*/

		
//		Giving key
		
		
		
		
		
		
						
				postGuest_json = JSON.parse(localStorage.postGuest);
				console.log(postGuest_json);
				let text = document.getElementById("roomID");
				let cartel = document.getElementById("cartel_reserva_creada");
				let localizador = document.getElementById("localizador");

				console.log("flag_reservation",localStorage.with_reservation_flag);
		
				if (localStorage.with_reservation_flag == "true"){ //El cliente ya tenia reserva y es hoy (true)  Se le da la llave
					
					text.textContent += postGuest_json.roomID;
					text.style.opacity = 1;

					var body = '{"roomName":"","checkIn":"","checkOut":""}';
					var body_json = JSON.parse(body);

					body_json.roomName = postGuest_json.roomID;
					body_json.checkIn = postGuest_json.startDate;
					body_json.checkOut = postGuest_json.endDate;
					body = JSON.stringify(body_json)

					




					//var body = '{"roomName": "217","checkIn":"2023-11-25","checkOut": "2023-11-26"}';
					//var body_json = JSON.parse(body);

					console.log("take_key", body);
					fetchAsync_take_key("http://localhost:5000/tesa/v1.0/checkIn",body);

					
					
				}else{
					cartel.style.opacity = 1;
					localizador.style.opacity = 1;
					localizador.textContent += " " + postGuest_json.reservationID;

				};
		/*
		
					var body = '{"hotelName": "Hotel Artxanda BILBAO","hotelPhone": "+34628234078","hotelAddress": " Carretera Santo Domingo a, Enekuri Artxanda Errepidea, 3, 48015 Bilbo,Bizkaia","checkIn": "","checkOut": "","roomType": "","reservationID":"","taxRate": "21","roomPrice": "","items": {"Late Check-Out": "15","Extra clean": "50"}}';
		
					var body_json = JSON.parse(body);






					body_json.roomType = postGuest_json.roomType;
					body_json.reservationID = postGuest_json.reservationID;
					body_json.checkIn = postGuest_json.startDate;
					body_json.checkOut = postGuest_json.endDate;
					body_json.roomPrice = postGuest_json.balance;
		
		
		
					body = JSON.stringify(body_json)

					console.log("Print ticket", body);*/
//					fetchAsync_print_ticket("http://localhost:8080/api-hardware/v1/printer/msh245/printTicket ",body);
		
		


				setTimeout( function(){window.location.href = "/index.html";
								},10000 )
		
	</script>
</html>
