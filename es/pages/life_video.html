<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Webcam Video Display</title>
    <link href="https://fonts.googleapis.com/css?family=DM Sans" rel="stylesheet">
      <link rel="stylesheet" href="style_2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="js/api_request.js"></script>
    <script src="script.js"></script>
    <script type="text/javascript" src="https://cdn.weglot.com/weglot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.12/sweetalert2.all.js" integrity="sha512-7TfWz/1TEVLE2pG8KLC/suq4qgXocI+/sNKfX0yifGXBbSKPoA9wcQ2GDublV7SSCu90vnW1q7+TUXOYaCIshA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      #videoElement {
		    margin-top: 20px;
        width: 500px;
        border-radius: 10%; 
        overflow: hidden; 
      }
    </style>
  </head>
  <body style="background: #EBEBEB;justify-content:center;display:flex;margin:0px; font-family: 'DM Sans';zoom:150%">
    <audio  id="audio"  src="../../media/obturador.mp3"  type="audio/mpeg" style="position:absolute"> </audio>
    <audio  id="carga"  src="../../media/carga_flash.mp3"  type="audio/mpeg" style="position:absolute"> </audio>
  
    <p class="fundir" style="font-weight: bold; font-size: 24px; position: absolute;bottom:34px;right:214px;opacity:0"> Powered by: </p>
    <img src="image/logo.png" alt="logo" class=" fundir" style=" position: absolute;bottom:0px;right:0px; height:180px;opacity:0">
    <span style="position: absolute;margin-top: 25vh;margin-left: -100%;" class="dot"></span>
  
    <div class="fundir" style=" border-radius: 25px;background-color:white;height:800px; width: 500px;margin-top: 8vh;opacity:0;display:block;text-align:center">
      <h2 style=" color: #6B43F1;margin-top: 50px;font-size: 30px;">Col칩quese en la posici칩n que ve en pantalla y pulse "Aceptar" para comenzar la cuenta atr치s</h2>
      <div style="height: 376px;width: 500px;left: 110px;top: 349px;border-radius: 10%;position: absolute;overflow: hidden;">
        <img style="position: absolute;left: 0px;width: 500px;height: 426px;" src="image/silueta.png" id="silueta">
      </div>
      <video autoplay="true" id="videoElement"></video>
      <span style="display:none;position:absolute;top:740px;left:345px;font-weight:900;font-size:50px;color:#6B43F1;" id="cuenta_atras">5</span><br>
      <button onclick="cuenta_atras()" class="custom-btn btn-16" style="width: 150px; height: 50px; font-size: 30px;padding: 0px;margin-top:97px">Aceptar</button>
    </div>
    <div id="capa_blanca" style="display:none;position:absolute;width:100%;height:100%;z-index:10;background-color:white"></div>
    <span id="camera" style="display:none"></span>
    <script>

      
			$(".fundir").animate({opacity:"1"});


      function cuenta_atras(){
        
        document.getElementById("carga").play()
        $("#cuenta_atras").show();
        var intervalo = setInterval(function(){
          if($("#cuenta_atras").text() == "1" ){
            clearInterval(intervalo)
            sacarFoto()
          }
          $("#cuenta_atras").text($("#cuenta_atras").text()-1)
        }, 1000)
      }
      
      function sacarFoto(){
        $("#capa_blanca").show();
        $("#capa_blanca").fadeOut();
        $("#cuenta_atras").hide();
        $("#silueta").hide()
        document.getElementById("audio").play()
        
        const video = document.getElementById("videoElement");
        
        video.pause()
        
        navigator.mediaDevices.getUserMedia({video: { frameRate:{ ideal: 0, max:1}}})
          .then(function (stream) {
            video.srcObject = stream;
          })

        
        var tracks = video.srcObject.getTracks();

        // Detener cada pista de la c치mara
        tracks.forEach(function(track) {
          track.stop();
        });
        //take_picture()
        
      }


      // Get the video element
      const video = document.getElementById("videoElement");

      // Check if the browser supports getUserMedia API
      if (navigator.mediaDevices.getUserMedia) {
        // Request access to the webcam
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then(function (stream) {
            // Set the video source to the stream from the webcam
            video.srcObject = stream;
          })
          .catch(function (error) {
            console.log("Error accessing the webcam: ", error);
          });
      } else {
        console.log("getUserMedia not supported");
      }

  function take_picture(){
		console.log("Taking picture");
		
		var guest2process_data = JSON.parse(localStorage.guest2process_data);
		var postGuest_json2 = JSON.parse(localStorage.postGuest);
		
		// var response = fetchAsync_getPicture("http://localhost:5000/picture?reservationID=11111&guest_i=00");
		var response = fetchAsync_getPicture("http://localhost:5000/picture?reservationID="+postGuest_json2.reservationID+"&guest_i="+guest2process_data.i);
		
		
	}
    </script>
  </body>
</html>
